services:
  frontend:
    build:
      context: ./frontend
      args:
        # NEXT_PUBLIC_* vars must be passed as build args so Next.js can
        # inline them into the JS bundle at build time.
        # Backend runs on Brain 1 (this workstation)
        NEXT_PUBLIC_API_URL: http://localhost:8300
        NEXT_PUBLIC_WS_URL: ws://localhost:18789
    ports:
      - "3300:3000"
    restart: unless-stopped

  backend:
    build: ./backend
    ports:
      - "8300:8300"
    environment:
      # --- Brain 2 (10.0.0.11) — app backends (permanent) ---
      KANBAN_API_URL: http://10.0.0.11:18794
      TEAM_DASHBOARD_URL: http://10.0.0.11:18795
      QDRANT_URL: http://10.0.0.11:6333
      FASTEMBED_URL: http://10.0.0.11:11435
      POSTGRES_URL: postgresql+asyncpg://friday:friday-brain2-2026@10.0.0.11:5433/knowledge
      # --- Brain 1 (10.0.0.1) — services awaiting migration to Brain 2 ---
      OPENCLAW_WS_URL: ws://10.0.0.1:18789
      OPENCLAW_API_URL: http://10.0.0.1:18789
      MENTAL_LIBRARY_API_URL: http://10.0.0.1:8100
      LEADGEN_BACKEND_URL: http://10.0.0.1:8200
      LEADGEN_DB_URL: postgresql+asyncpg://leadgen:leadgen-yieldlabs-2026@10.0.0.1:5434/leadgen
      # SQLite read-only mount from the mental-library skill volume
      MENTAL_LIBRARY_DB: /data/mental-library/mental_library.db
    restart: unless-stopped
    network_mode: host
    volumes:
      - /home/eddy/.openclaw/workspace/skills/mental-library/backend/data:/data/mental-library:ro
      - /tmp/whisper-transcribe.sock:/tmp/whisper-transcribe.sock
      - /home/eddy/.openclaw/workspace/skills/voice-io/scripts:/voice-io-scripts:ro
